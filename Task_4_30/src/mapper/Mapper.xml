<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zh.dao.StuDao">

 <select id="findAll" resultType="com.zh.pojo.Stu">
  select stu.*,count(c_name) as count,group_concat(c_name) as courseName  from stu left join stu_course sc on stu.s_id = sc.s_id
   left join course c on sc.c_id = c.c_id
  group by stu.s_id
 </select>

 <delete id="del">
  delete stu,stu_course from stu,stu_course where stu.s_id = ${sId} and stu_course.s_id = ${sId};
 </delete>

 <select id="findCourseName" resultType="com.zh.pojo.Course">
  select c_id, c_name from course;
 </select>

 <insert id="addStu" useGeneratedKeys="true" keyProperty="sId">
  insert into stu(s_name, s_sex, s_birth, s_score)
  VALUES (#{sName},#{sSex},#{sBirth},#{sScore})
 </insert>
 
 <insert id="addCourse">
  insert into stu_course(s_id, c_id)
  VALUES (#{sId},#{s})
 </insert>

 <select id="findById" resultType="com.zh.pojo.Stu">
select stu.*,group_concat(stu_course.c_id) as cIds,group_concat(c_name) as courseName from stu
        left join stu_course on stu.s_id = stu_course.s_id
        left join course on stu_course.c_id = course.c_id where stu.s_id = ${sId} group by stu.s_id
 </select>

 <delete id="delStu">
  delete from stu_course where s_id = #{sId}
 </delete>

 <update id="updateStu">
  update stu set s_name = #{sName} ,s_sex = #{sSex},s_birth = #{sBirth} where s_id = #{sId}
 </update>

 </mapper> 